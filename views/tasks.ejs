<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title><%= project.name %> Tasks</title>
</head> 
<body>
    <h1>Tasks for Project: <%= project.name %></h1>

    <% if (tasks.length > 0) { %>
        <ul>
            <% tasks.forEach(function(task) { %>
                <li>
                    <strong>Task Name:</strong> <%= task.name %><br>
                    <strong>Description:</strong> <%= task.description %><br>
                    <strong>Priority:</strong> <%= task.priority %><br>
                    <strong>Progress:</strong> <%= task.progress %><br>
                    <strong>Start Date:</strong> <%= new Date(task.startDate).toISOString().split('T')[0] %></p>
                    <strong>End Date:</strong> <%= new Date(task.endDate).toISOString().split('T')[0] %></p>
                    <strong>Time Estimation:</strong> <%= task.timeEstimation %> hours<br>
                    <strong>Comments:</strong> <%= task.comments || 'N/A' %><br>
                    <strong>Users:</strong> 
                    <% if (task.users && task.users.length > 0) { %>
                        <%= task.users.map(user => user.username).join(', ') %>
                    <% } else { %>
                        N/A
                    <% } %>
                    <br>
                    <br>
                    <!-- Modify, Delete and Add Member buttons -->
                    <% if (project.administrator.toString() === userId.toString()) { %>
                        <form action="/task/edit/<%= task._id %>" method="get" style="display: inline;">
                            <input type="hidden" name="projectId" value="<%= project._id %>">
                            <button type="submit">Modify Task</button>
                        </form>
                        <form action="/task/delete/<%= task._id %>" method="post" style="display: inline;">
                            <input type="hidden" name="projectId" value="<%= project._id %>">
                            <button type="submit">Delete Task</button>
                        </form>
                        <form action="/task/addMember/<%= task._id %>" method="get" style="display: inline;">
                            <input type="hidden" name="projectId" value="<%= project._id %>">
                            <button type="submit">Add Task Member</button>
                        </form>                       
                    <% } %>
                </li>
                <hr>
            <% }) %>
        </ul>
    <% } else { %>
        <p>No tasks available</p>
    <% } %>

    <!-- Navigation Buttons -->
    <form action="/proyects" method="get" style="display: inline;">
        <button type="submit">Back to Projects</button>
    </form>
    <form action="/createTask/<%= project._id %>" method="get" style="display: inline;">
        <button type="submit">Create Task</button>
    </form>
    <form action="/addMember/<%= project._id %>" method="get" style="display: inline;">
        <button type="submit">Add Member</button>
    </form>
</body>
</html>

